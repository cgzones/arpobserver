name: "CodeQL"

on:
  push:
    branches: [master]
  pull_request:
    branches: [master]
  schedule:
    - cron: '0 1 * * *'

permissions:
  contents: read

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest
    concurrency:
      group: ${{ github.workflow }}-${{ matrix.language }}-${{ github.ref }}
      cancel-in-progress: true
    permissions:
      actions: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        language: [ 'cpp' ]

    steps:
    - name: Checkout Repository
      uses: actions/checkout@230611dbd0eb52da1e1f4f7bc8bb0c3a339fc8b7

    - name: Initialize CodeQL
      uses: github/codeql-action/init@bcd7e6896fd183906513908bcc690ef5a3345f1c
      with:
        languages: ${{ matrix.language }}

    - name: Install Dependencies (standard)
      run: sudo apt-get install -y libevent-dev libmysqlclient-dev libpcap-dev libsqlite3-dev pkg-config

    - name: Install dependencies (extra)
      run: |
          wget -O - https://ftp-master.debian.org/keys/archive-key-10.asc 2>/dev/null | sudo apt-key add -
          sudo add-apt-repository 'deb http://deb.debian.org/debian/ sid main' -y
          sudo apt-get update -q
          sudo apt-get install -y asciidoctor check

    - name: Autobuild
      uses: github/codeql-action/autobuild@bcd7e6896fd183906513908bcc690ef5a3345f1c

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@bcd7e6896fd183906513908bcc690ef5a3345f1c
